image: deinternetjongens/php7.2:latest
pipelines:
  default:
  - step:
      caches:
      - composer
      - node
      script:
      - echo $SSH_KEY > ~/.ssh/id_rsa.tmp
      - base64 -d ~/.ssh/id_rsa.tmp > ~/.ssh/id_rsa
      - chmod 600 ~/.ssh/id_rsa
      - base64 ~/.ssh/id_rsa
      - composer install --no-scripts
      - bash ./automate.sh
  branches:
    develop:
    - step:
        caches:
        - composer
        - node
        script:
        - echo $SSH_KEY > ~/.ssh/id_rsa.tmp
        - base64 -d ~/.ssh/id_rsa.tmp > ~/.ssh/id_rsa
        - chmod 600 ~/.ssh/id_rsa
        - base64 ~/.ssh/id_rsa
        - composer install
        - bash ./automate.sh
    master:
    - step:
        caches:
        - composer
        - node
        script:
        - echo $SSH_KEY > ~/.ssh/id_rsa.tmp
        - base64 -d ~/.ssh/id_rsa.tmp > ~/.ssh/id_rsa
        - chmod 600 ~/.ssh/id_rsa
        - base64 ~/.ssh/id_rsa
        - composer install
        - bash ./automate.sh
